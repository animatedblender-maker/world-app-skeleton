import{a as M}from"./chunk-NOJK5XQQ.js";import{Ba as x,a as A,k as p,n as L}from"./chunk-XHC7PKXJ.js";function E(e){return(e||"").trim().toLowerCase().replace(/\s+/g," ").replace(/[â€™']/g,"").replace(/[^a-z0-9 ]/g,"")}function q(e){let n=String(e??"").trim().toUpperCase();return/^[A-Z]{2}$/.test(n)?n:null}function T(e){let n=[],t=s=>{if(Array.isArray(s))for(let c of s)Array.isArray(c)&&c.length>=2&&n.push([c[0],c[1]])},o=e?.type,a=e?.coordinates;if(!o||!Array.isArray(a))return null;if(o==="Polygon")for(let s of a)t(s);else if(o==="MultiPolygon"){for(let s of a)if(Array.isArray(s))for(let c of s)t(c)}if(!n.length)return null;let r=0,i=0;for(let[s,c]of n)r+=s,i+=c;return{lng:r/n.length,lat:i/n.length}}function j(e){let n=[],t=u=>{if(Array.isArray(u))for(let l of u)Array.isArray(l)&&l.length>=2&&n.push([l[0],l[1]])},o=e?.type,a=e?.coordinates;if(!o||!Array.isArray(a))return null;if(o==="Polygon")for(let u of a)t(u);else if(o==="MultiPolygon"){for(let u of a)if(Array.isArray(u))for(let l of u)t(l)}if(!n.length)return null;let r=1/0,i=-1/0,s=1/0,c=-1/0;for(let[u,l]of n)u<r&&(r=u),u>i&&(i=u),l<s&&(s=l),l>c&&(c=l);return{minLat:s,maxLat:c,minLng:r,maxLng:i}}function N(e,n){let t=Math.max(.1,e*n),o=.25+Math.log10(t+1)*.25;return Math.max(.22,Math.min(1.1,o))}function O(e,n){let t=Math.max(e,n),o=.7+Math.min(2.2,t/22);return Math.max(.9,Math.min(2.25,o))}function w(e,n,t){let o=!1;for(let a=0,r=t.length-1;a<t.length;r=a++){let i=t[a][0],s=t[a][1],c=t[r][0],u=t[r][1];s>n!=u>n&&e<(c-i)*(n-s)/(u-s||1e-12)+i&&(o=!o)}return o}function P(e,n,t){if(!Array.isArray(t)||!t.length)return!1;let o=t[0];if(!Array.isArray(o)||o.length<3||!w(e,n,o))return!1;for(let a=1;a<t.length;a++){let r=t[a];if(Array.isArray(r)&&r.length>=3&&w(e,n,r))return!1}return!0}function z(e,n,t){let o=e?.type,a=e?.coordinates;if(!o||!Array.isArray(a))return!1;if(o==="Polygon")return P(n,t,a);if(o==="MultiPolygon"){for(let r of a)if(P(n,t,r))return!0;return!1}return!1}function G(e){let n=e>>>0;return()=>{n|=0,n=n+1831565813|0;let t=Math.imul(n^n>>>15,1|n);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}function k(e){let n=2166136261;for(let t=0;t<e.length;t++)n^=e.charCodeAt(t),n=Math.imul(n,16777619);return Math.abs(n)}function F(e,n){let t=e?.geometry,o=j(t),a=T(t)||{lat:0,lng:0};if(!o)return[a];let{minLat:r,maxLat:i,minLng:s,maxLng:c}=o,u=Math.max(.1,i-r),l=Math.max(.1,c-s),f=Math.max(40,Math.min(n,Math.floor(50+u*l*1.5))),h=k((e?.properties?.ISO_A2??e?.properties?.NAME??"")+"|"+e?.__id),y=G(h),m=[],C=f*50,g=0;for(;m.length<f&&g<C;){g++;let d=s+y()*(c-s),b=r+y()*(i-r);z(t,d,b)&&m.push({lat:b,lng:d})}return m.length||m.push(a),m}var I=class e{async loadCountries(){let n=await this.fetchCountriesGeoJson(),o=(Array.isArray(n?.features)?n.features:[]).filter(r=>r?.geometry?.type==="Polygon"||r?.geometry?.type==="MultiPolygon").filter(r=>(r?.properties?.NAME||r?.properties?.ADMIN)&&r?.properties?.ISO_A2!=="AQ");o.forEach((r,i)=>r.__id=i+1);let a=o.map(r=>{let i=r.properties||{},s=i.NAME||i.ADMIN||"Unknown",c=T(r.geometry)||{lat:0,lng:0},u=j(r.geometry),l=u?Math.max(.1,u.maxLat-u.minLat):10,f=u?Math.max(.1,u.maxLng-u.minLng):10,h=q(i.ISO_A2??i.iso_a2??i.ISO2),y=F(r,240);return{id:r.__id,name:s,norm:E(s),center:c,labelSize:N(l,f),flyAltitude:O(l,f),code:h,pointPool:y}}).sort((r,i)=>r.name.localeCompare(i.name));return{features:o,countries:a}}async fetchCountriesGeoJson(){let n=["/countries50m.geojson","/public/countries50m.geojson","/assets/countries50m.geojson","/assets/countries.geojson"],t=null;for(let o of n)try{let a=await fetch(o);if(!a.ok)throw new Error(`${o} HTTP ${a.status}`);return await a.json()}catch(a){t=a}throw t||new Error("GeoJSON fetch failed")}static \u0275fac=function(t){return new(t||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};var S=class e{constructor(n){this.auth=n}endpoint=M.graphqlEndpoint||"http://localhost:3000/graphql";async query(n,t){return this.request(n,t)}async mutate(n,t){return this.request(n,t)}async request(n,t){let o=await this.auth.getAccessToken(),a=await fetch(this.endpoint,{method:"POST",headers:A({"content-type":"application/json"},o?{Authorization:`Bearer ${o}`}:{}),body:JSON.stringify({query:n,variables:t??void 0})}),r=await a.json();if(!a.ok)throw new Error(`GraphQL HTTP ${a.status}: ${JSON.stringify(r)}`);if(r.errors?.length)throw new Error(r.errors.map(i=>i.message).join(" | "));if(!r.data)throw new Error("GraphQL: missing data");return r.data}static \u0275fac=function(t){return new(t||e)(L(x))};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};export{I as a,S as b};
