<!-- Background App (blurred + disabled until logged in) -->
<div class="app-shell" [class.blurred]="!user">
  <!-- UI -->
  <div class="topbar">
    <div class="searchwrap">
      <input id="search" placeholder="Search a country on the globe…" />
      <div id="clearBtn" class="clear-btn">×</div>
      <div id="suggestions" class="suggestions"></div>
    </div>
    <button id="go" class="go-btn">GO</button>
  </div>

  <div class="stats">
    <div><b>Country:</b> <span id="countryPill">Hover / click a country</span></div>
    <div class="row">
      <small id="totalUsers">Total users: —</small>
      <small id="onlineUsers">Online now: —</small>
    </div>
    <div class="row">
      <small id="authState">{{ user ? ('Logged in: ' + user.email) : 'Not logged in' }}</small>
      <small id="heartbeatState">—</small>
    </div>
  </div>

  <!-- Globe container -->
  <div id="globe"></div>
</div>

<!-- Sci-Fi Auth Overlay -->
<div class="auth-overlay" *ngIf="!user">
  <div class="auth-frame">
    <div class="scanlines"></div>
    <div class="grid"></div>

    <div class="auth-card">
      <div class="auth-brand">
        <div class="brand-mark"></div>
        <div class="brand-text">
          <div class="brand-title">WORLD APP</div>
          <div class="brand-sub">Authenticate to synchronize your node.</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab" [class.active]="activeTab === 'login'" (click)="activeTab = 'login'">
          LOGIN
        </button>
        <button class="tab" [class.active]="activeTab === 'register'" (click)="activeTab = 'register'">
          REGISTER
        </button>
      </div>

      <form class="form" (submit)="$event.preventDefault(); onSubmit()">
        <label class="field">
          <span>IDENTIFIER (EMAIL)</span>
          <input
            type="email"
            name="email"
            [(ngModel)]="email"
            placeholder="you@example.com"
            autocomplete="email"
            required
          />
        </label>

        <label class="field">
          <span>ACCESS KEY (PASSWORD)</span>
          <input
            type="password"
            name="password"
            [(ngModel)]="password"
            placeholder="••••••••"
            autocomplete="current-password"
            required
            minlength="6"
          />
        </label>

        <div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>

        <button class="cta" type="submit" [disabled]="busy">
          {{ busy ? 'LINKING…' : (activeTab === 'login' ? 'LOGIN' : 'CREATE ACCOUNT') }}
        </button>

        <div class="hint" *ngIf="activeTab === 'register'">
          If email confirmation is enabled in Supabase, you’ll need to confirm your email.
        </div>
      </form>
    </div>
  </div>
</div>
