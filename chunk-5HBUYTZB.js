import{b as a}from"./chunk-KO5X6LCN.js";import{a as r,k as o}from"./chunk-SPQ2JWKS.js";var c=class s{channel=null;insertSubject=new r;insert$=this.insertSubject.asObservable();updateSubject=new r;update$=this.updateSubject.asObservable();start(e){e&&(this.stop(),this.channel=a.channel(`public:notifications:${e}`),this.channel.on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${e}`},({new:t})=>{let n=t?.id,i=t?.user_id;typeof n!="string"||typeof i!="string"||this.insertSubject.next({id:n,user_id:i,read_at:typeof t?.read_at=="string"?t.read_at:null,type:typeof t?.type=="string"?t.type:null})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:`user_id=eq.${e}`},({new:t})=>{let n=t?.id,i=t?.user_id;typeof n!="string"||typeof i!="string"||this.updateSubject.next({id:n,user_id:i,read_at:typeof t?.read_at=="string"?t.read_at:null,type:typeof t?.type=="string"?t.type:null})}).subscribe())}stop(){if(this.channel){try{a.removeChannel(this.channel)}catch{}this.channel=null}}ngOnDestroy(){this.stop()}static \u0275fac=function(t){return new(t||s)};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};export{c as a};
