import{a as A}from"./chunk-TS4QU3HE.js";import{b as N}from"./chunk-JLBVTQ6O.js";import{b as V}from"./chunk-YRPTNGKR.js";import{a as D}from"./chunk-YQ2TA2FF.js";import"./chunk-LJDR2ADK.js";import"./chunk-7DJA5TI4.js";import"./chunk-AFJFBD4M.js";import"./chunk-LQQHCQP3.js";import"./chunk-KO5X6LCN.js";import{C as v,Ca as E,D as o,Da as k,G as x,Ga as U,H as S,Ia as z,L as c,P as a,Q as r,R as s,S as _,V as h,W as C,Y as O,Z as I,_ as p,fa as d,ga as m,ha as u,ia as w,p as y,q as P,qa as b,ra as M,ya as T}from"./chunk-SPQ2JWKS.js";import"./chunk-2NFLSA4Y.js";function B(e,n){e&1&&(r(0,"div",5),d(1,"Loading post..."),s())}function F(e,n){if(e&1&&(r(0,"div",6),d(1),s()),e&2){let t=p();o(),m(t.error)}}function R(e,n){if(e&1&&_(0,"img",23),e&2){let t=p(2);a("src",t.post.author==null?null:t.post.author.avatar_url,v)}}function H(e,n){if(e&1&&(r(0,"div",24),d(1),s()),e&2){let t=p(2);o(),u(" ",((t.post.author==null?null:t.post.author.display_name)||(t.post.author==null?null:t.post.author.username)||"U").slice(0,2).toUpperCase()," ")}}function L(e,n){if(e&1&&(r(0,"span"),d(1),s()),e&2){let t=p(2);o(),u("\u2022 ",t.post.city_name)}}function W(e,n){if(e&1&&(r(0,"div",25),d(1),s()),e&2){let t=p(2);o(),m(t.post.title)}}function q(e,n){if(e&1&&(r(0,"div",26),d(1),s()),e&2){let t=p(2);o(),u(" ",t.post.body," ")}}function $(e,n){if(e&1&&_(0,"img",23),e&2){let t=p().ngIf;a("src",t.author==null?null:t.author.avatar_url,v)}}function J(e,n){if(e&1&&(r(0,"div",39),d(1),s()),e&2){let t=p().ngIf;o(),u(" ",((t.author==null?null:t.author.display_name)||(t.author==null?null:t.author.username)||"User").slice(0,2).toUpperCase()," ")}}function Y(e,n){if(e&1&&(r(0,"span"),d(1),s()),e&2){let t=p().ngIf;o(),u(" - ",t.country_name||t.country_code)}}function G(e,n){if(e&1&&(r(0,"div",40),d(1),s()),e&2){let t=p().ngIf;o(),m(t.title)}}function K(e,n){if(e&1&&(r(0,"div",41),d(1),s()),e&2){let t=p().ngIf,i=p(2);o(),m(i.postPreview(t.body))}}function Q(e,n){if(e&1&&_(0,"img",45),e&2){let t=p(2).ngIf;a("src",t[0],v)}}function X(e,n){if(e&1&&_(0,"img",49),e&2){let t=p(5).ngIf;a("src",t.thumb_url,v)}}function Z(e,n){if(e&1&&(r(0,"div",46),c(1,X,1,1,"img",47),r(2,"div",48),d(3,"Video"),s()()),e&2){let t=p(4).ngIf;o(),a("ngIf",t.thumb_url)}}function tt(e,n){if(e&1&&(h(0),c(1,Q,1,1,"img",43)(2,Z,4,1,"div",44),C()),e&2){let t=n.ngIf;o(),a("ngIf",t[0]==="image"),o(),a("ngIf",t[0]==="video")}}function et(e,n){if(e&1&&(h(0),c(1,tt,3,2,"ng-container",14),C()),e&2){let t=p(2).ngIf,i=p(2);o(),a("ngIf",i.postMediaTypes(t))}}function nt(e,n){if(e&1&&(r(0,"div",42),c(1,et,2,1,"ng-container",14),s()),e&2){let t=p().ngIf,i=p(2);o(),a("ngIf",i.postMediaUrls(t))}}function it(e,n){if(e&1){let t=O();r(0,"div",27)(1,"div",28),d(2,"Shared post"),s(),r(3,"div",29),I("click",function(l){let g=y(t).ngIf,f=p(2);return P(f.openSharedPost(g,l))})("keyup.enter",function(l){let g=y(t).ngIf,f=p(2);return P(f.openSharedPost(g,l))}),r(4,"div",30)(5,"div",31),c(6,$,1,1,"img",9)(7,J,2,1,"div",32),s(),r(8,"div",33)(9,"div",34),d(10),s(),r(11,"div",35),d(12),b(13,"date"),c(14,Y,2,1,"span",14),s()()(),c(15,G,2,1,"div",36)(16,K,2,1,"div",37)(17,nt,2,1,"div",38),s()()}if(e&2){let t=n.ngIf;o(6),a("ngIf",t.author==null?null:t.author.avatar_url),o(),a("ngIf",!(t.author!=null&&t.author.avatar_url)),o(3),m((t.author==null?null:t.author.display_name)||(t.author==null?null:t.author.username)||"Member"),o(2),w(" @",(t.author==null?null:t.author.username)||"user"," \xC2\xB7 ",M(13,9,t.created_at,"mediumDate")," "),o(2),a("ngIf",t.country_name||t.country_code),o(),a("ngIf",t.title),o(),a("ngIf",t.body),o(),a("ngIf",t.media_url&&t.media_type!=="none")}}function ot(e,n){if(e&1&&_(0,"img",55),e&2){let t=p(3).ngIf;a("src",t[0],v)}}function at(e,n){if(e&1&&_(0,"app-video-player",56),e&2){let t=p(3).ngIf,i=p(2);a("src",t[0])("poster",i.post.thumb_url||null)}}function rt(e,n){if(e&1&&(r(0,"div",52),c(1,ot,1,1,"img",53)(2,at,1,2,"app-video-player",54),s()),e&2){let t=p().ngIf;o(),a("ngIf",t[0]==="image"),o(),a("ngIf",t[0]==="video")}}function st(e,n){if(e&1&&(r(0,"div",57),d(1),s()),e&2){let t=p(4);o(),u(" ",t.postCaptionText(t.post)," ")}}function pt(e,n){if(e&1&&(h(0),c(1,rt,3,2,"div",50)(2,st,2,1,"div",51),C()),e&2){let t=p().ngIf,i=p(2);o(),a("ngIf",t.length),o(),a("ngIf",t.length&&i.postCaptionText(i.post))}}function dt(e,n){if(e&1&&(h(0),c(1,pt,3,2,"ng-container",14),C()),e&2){let t=p(2);o(),a("ngIf",t.postMediaTypes(t.post))}}function lt(e,n){if(e&1&&(r(0,"div",5)(1,"div",7)(2,"div",8),c(3,R,1,1,"img",9)(4,H,2,1,"div",10),s(),r(5,"div",11)(6,"div",12),d(7),s(),r(8,"div",13),d(9),c(10,L,2,1,"span",14),s()(),r(11,"div",15),d(12),b(13,"date"),s()(),c(14,W,2,1,"div",16)(15,q,2,1,"div",17)(16,it,18,12,"div",18)(17,dt,2,1,"ng-container",14),r(18,"div",19)(19,"div",20)(20,"span",21),d(21,"\u2661"),s(),r(22,"span",22),d(23),s()(),r(24,"div",20)(25,"span",21),d(26,"\u{1F4AC}"),s(),r(27,"span",22),d(28),s()(),r(29,"div",20)(30,"span",21),d(31,"\u{1F441}"),s(),r(32,"span",22),d(33),s()()()()),e&2){let t=p();o(3),a("ngIf",t.post.author==null?null:t.post.author.avatar_url),o(),a("ngIf",!(t.post.author!=null&&t.post.author.avatar_url)),o(3),m((t.post.author==null?null:t.post.author.display_name)||(t.post.author==null?null:t.post.author.username)||"Member"),o(2),u(" ",t.post.country_name||t.post.country_code||""," "),o(),a("ngIf",t.post.city_name),o(2),m(M(13,13,t.post.created_at,"medium")),o(2),a("ngIf",t.post.title),o(),a("ngIf",t.post.body&&!t.postHasVideo(t.post)),o(),a("ngIf",t.post.shared_post),o(),a("ngIf",t.postMediaUrls(t.post)),o(6),m(t.post.like_count),o(5),m(t.post.comment_count),o(5),m(t.post.view_count)}}var j=class e{constructor(n,t,i,l){this.route=n;this.router=t;this.posts=i;this.notifications=l}post=null;loading=!0;error="";postHasVideo(n){return n?String(n.media_type||"").toLowerCase()==="video"?!0:this.postMediaUrls(n).some(i=>/\.(mp4|webm|mov|m4v|avi|mkv)(\?|#|$)/.test(String(i).toLowerCase())):!1}postCaptionText(n){if(!n)return"";let t=String(n.media_caption||"").trim();return t||(this.postHasVideo(n)?String(n.body||"").trim():"")}postPreview(n){let t=String(n||"").replace(/\s+/g," ").trim();if(!t)return"";let i=140;if(t.length<=i)return t;let l=t.slice(0,i),g=l.lastIndexOf(" ");return(g>40?l.slice(0,g):l).trim()}postMediaUrls(n){if(!n)return[];let t=String(n.media_url||"").trim();if(!t)return[];if(t.startsWith("{")||t.startsWith("["))try{let i=JSON.parse(t);if(Array.isArray(i))return i.filter(Boolean).map(String);if(Array.isArray(i?.urls))return i.urls.filter(Boolean);if(i?.url)return[i.url]}catch{}return[t]}postMediaTypes(n){if(!n)return[];let t=String(n.media_url||"").trim();if(!t)return[];if(t.startsWith("{")||t.startsWith("["))try{let i=JSON.parse(t);if(Array.isArray(i))return i.map(l=>this.inferMediaTypeFromUrl(l,n.media_type));if(Array.isArray(i?.types)&&i.types.length)return Array.isArray(i?.urls)&&i.urls.length?i.urls.map((l,g)=>{let f=i.types?.[g];return f==="video"||f==="image"?f:this.inferMediaTypeFromUrl(l,n.media_type)}):i.types.map(l=>l==="video"?"video":"image");if(Array.isArray(i?.urls))return i.urls.map(l=>this.inferMediaTypeFromUrl(l,n.media_type));if(i?.url)return[this.inferMediaTypeFromUrl(i.url,n.media_type)]}catch{}return[this.inferMediaTypeFromUrl(t,n.media_type)]}inferMediaTypeFromUrl(n,t){let i=String(n||"").toLowerCase();return/\.(mp4|webm|mov|m4v|avi|mkv)(\?|#|$)/.test(i)?"video":/\.(jpg|jpeg|png|gif|webp|avif)(\?|#|$)/.test(i)?"image":String(t||"").toLowerCase()==="video"?"video":"image"}async ngOnInit(){let n=String(this.route.snapshot.paramMap.get("id")||"").trim();if(!n){this.error="Post not found.",this.loading=!1;return}try{this.post=await this.posts.getPostById(n),this.post||(this.error="Post not found.")}catch(t){this.error=t?.message??String(t)}finally{this.loading=!1}}goHome(){this.router.navigate(["/globe"])}goMessages(){this.router.navigate(["/messages"])}openNotifications(){this.router.navigate(["/globe"],{queryParams:{panel:"notifications"}})}openSearch(){this.router.navigate(["/globe"],{queryParams:{search:"1"}})}openSharedPost(n,t){if(t&&(t.preventDefault(),t.stopPropagation()),!n)return;let i=n.shared_post_id||n.id;i&&this.router.navigate(["/globe"],{queryParams:{post:i,tab:"posts",panel:null}})}static \u0275fac=function(t){return new(t||e)(x(U),x(z),x(N),x(D))};static \u0275cmp=S({type:e,selectors:[["app-post-page"]],decls:7,vars:3,consts:[[1,"post-shell"],["type","button",1,"logo-btn",3,"click"],["src","/logo.png","alt","Matterya"],["class","post-card",4,"ngIf"],["class","post-card error",4,"ngIf"],[1,"post-card"],[1,"post-card","error"],[1,"post-head"],[1,"author-avatar"],["alt","avatar",3,"src",4,"ngIf"],["class","author-initials",4,"ngIf"],[1,"author-meta"],[1,"author-name"],[1,"author-sub"],[4,"ngIf"],[1,"post-time"],["class","post-title",4,"ngIf"],["class","post-body",4,"ngIf"],["class","post-shared",4,"ngIf"],[1,"post-actions"],[1,"post-action"],[1,"icon"],[1,"count"],["alt","avatar",3,"src"],[1,"author-initials"],[1,"post-title"],[1,"post-body"],[1,"post-shared"],[1,"shared-label"],["role","button","tabindex","0",1,"shared-card",3,"click","keyup.enter"],[1,"shared-author"],[1,"shared-avatar"],["class","shared-initials",4,"ngIf"],[1,"shared-info"],[1,"shared-name"],[1,"shared-meta"],["class","shared-title",4,"ngIf"],["class","shared-body",4,"ngIf"],["class","shared-media",4,"ngIf"],[1,"shared-initials"],[1,"shared-title"],[1,"shared-body"],[1,"shared-media"],["alt","shared media",3,"src",4,"ngIf"],["class","shared-video",4,"ngIf"],["alt","shared media",3,"src"],[1,"shared-video"],["alt","video thumbnail",3,"src",4,"ngIf"],[1,"shared-video-tag"],["alt","video thumbnail",3,"src"],["class","post-media",4,"ngIf"],["class","post-caption",4,"ngIf"],[1,"post-media"],["alt","post media",3,"src",4,"ngIf"],["preload","metadata",3,"src","poster",4,"ngIf"],["alt","post media",3,"src"],["preload","metadata",3,"src","poster"],[1,"post-caption"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"button",1),I("click",function(){return i.goHome()}),_(2,"img",2),s(),c(3,B,2,0,"div",3)(4,F,2,1,"div",4)(5,lt,34,16,"div",3),s(),_(6,"app-bottom-tabs")),t&2&&(o(3),a("ngIf",i.loading),o(),a("ngIf",!i.loading&&i.error),o(),a("ngIf",!i.loading&&i.post))},dependencies:[k,T,A,V,E],styles:["[_nghost-%COMP%]{display:block;min-height:100dvh;height:100dvh;overflow:auto;background:radial-gradient(circle at 20% 10%,rgba(40,80,120,.2),transparent 45%),radial-gradient(circle at 80% 0%,rgba(20,60,100,.25),transparent 40%),#060a12;color:#e9f2ff}.post-shell[_ngcontent-%COMP%]{position:relative;min-height:100dvh;padding:88px 18px calc(24px + var(--tabs-safe, 64px));display:flex;flex-direction:column;align-items:center;gap:16px}.logo-btn[_ngcontent-%COMP%]{position:fixed;top:18px;left:18px;width:46px;height:46px;border-radius:50%;border:0;background:#060c16b3;display:grid;place-items:center;cursor:pointer;z-index:10}.logo-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:36px;height:36px}.post-card[_ngcontent-%COMP%]{width:min(720px,100%);background:#0a0e16db;border-radius:18px;border:1px solid rgba(255,255,255,.08);padding:20px;box-shadow:0 18px 60px #00000073}.post-card.error[_ngcontent-%COMP%]{border-color:#ff6e6e59;color:#ffb3b3}.post-head[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-bottom:12px}.author-avatar[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:50%;overflow:hidden;background:#ffffff1a;display:grid;place-items:center}.author-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.author-initials[_ngcontent-%COMP%]{font-weight:800;letter-spacing:.08em}.author-meta[_ngcontent-%COMP%]{flex:1;min-width:0}.author-name[_ngcontent-%COMP%]{font-weight:700}.author-sub[_ngcontent-%COMP%]{font-size:12px;opacity:.7}.post-time[_ngcontent-%COMP%]{font-size:11px;opacity:.7;white-space:nowrap}.post-title[_ngcontent-%COMP%]{font-weight:800;letter-spacing:.06em;text-transform:uppercase;margin-bottom:8px;font-size:12px}.post-body[_ngcontent-%COMP%]{line-height:1.6}.post-shared[_ngcontent-%COMP%]{margin-top:14px}.shared-label[_ngcontent-%COMP%]{font-size:11px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:#e9f2ff99;margin-bottom:6px}.shared-card[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;background:#060a1299;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease}.shared-card[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 12px 30px #00000059}.shared-author[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.shared-avatar[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:50%;overflow:hidden;background:#ffffff1a;display:grid;place-items:center;flex-shrink:0}.shared-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.shared-initials[_ngcontent-%COMP%]{font-weight:800;font-size:12px;letter-spacing:.08em}.shared-info[_ngcontent-%COMP%]{min-width:0}.shared-name[_ngcontent-%COMP%]{font-weight:800;font-size:13px}.shared-meta[_ngcontent-%COMP%]{font-size:11px;opacity:.7}.shared-title[_ngcontent-%COMP%]{margin-top:10px;font-weight:800;font-size:12px;letter-spacing:.06em;text-transform:uppercase}.shared-body[_ngcontent-%COMP%]{margin-top:6px;font-size:13px;line-height:1.4;color:#e9f2ffcc}.shared-media[_ngcontent-%COMP%]{margin-top:10px;border-radius:12px;overflow:hidden;background:#000}.shared-media[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.shared-video[_ngcontent-%COMP%]{position:relative;display:grid;place-items:center;min-height:120px;background:#0b0f18;color:#e6eefc;font-size:12px;letter-spacing:.08em;text-transform:uppercase}.shared-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.shared-video-tag[_ngcontent-%COMP%]{position:absolute;right:8px;bottom:8px;background:#000000a6;color:#fff;padding:4px 6px;border-radius:8px;font-size:10px;letter-spacing:.12em;text-transform:uppercase}.post-caption[_ngcontent-%COMP%]{margin-top:12px;line-height:1.5;opacity:.9}.post-media[_ngcontent-%COMP%]{margin-top:14px;border-radius:16px;overflow:hidden;background:#000}.post-media[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.post-actions[_ngcontent-%COMP%]{display:flex;gap:16px;margin-top:14px;font-size:12px;opacity:.8}.post-action[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.post-action[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:14px}"]})};export{j as PostPageComponent};
