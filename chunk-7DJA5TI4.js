import{a as m}from"./chunk-LQQHCQP3.js";import{c as g}from"./chunk-KO5X6LCN.js";import{k as p,n as h}from"./chunk-SPQ2JWKS.js";import{a as l}from"./chunk-2NFLSA4Y.js";var f=class i{constructor(o){this.auth=o}endpoint=m.graphqlEndpoint||"http://localhost:3000/graphql";async request(o,a){let c=await this.safeGetToken(),e,s="";try{e=await fetch(this.endpoint,{method:"POST",headers:l({"content-type":"application/json",accept:"application/json"},c?{authorization:`Bearer ${c}`}:{}),body:JSON.stringify({query:o,variables:a??{}})}),s=await e.text()}catch(r){let n=`GraphQL NETWORK error (endpoint=${this.endpoint}): ${r?.message??r}`;throw console.error("[gql] NETWORK",n),new Error(n)}let t=null;try{t=s?JSON.parse(s):null}catch{let r=`GraphQL NON-JSON response (HTTP ${e.status} ${e.statusText}) from ${this.endpoint}:
${s.slice(0,600)}`;throw console.error("[gql] NON-JSON",r),new Error(r)}if(!e.ok){let r=`GraphQL HTTP error ${e.status} ${e.statusText} from ${this.endpoint}:
${JSON.stringify(t).slice(0,800)}`;throw console.error("[gql] HTTP",r),new Error(r)}if(t?.errors?.length){console.error("[gql] GQL ERRORS",t.errors),console.error("[gql] GQL ERRORS JSON",JSON.stringify(t.errors));let r=t.errors[0],n=typeof r?.extensions?.code=="string"?r.extensions.code:null,u=n?`${r?.message??"GraphQL error."} (code=${n})`:r?.message??`GraphQL error: ${JSON.stringify(t.errors).slice(0,800)}`;throw new Error(u)}return t.data}async safeGetToken(){try{return await this.auth.getAccessToken()||null}catch(o){return console.warn("[gql] token missing:",o),null}}static \u0275fac=function(a){return new(a||i)(h(g))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a};
