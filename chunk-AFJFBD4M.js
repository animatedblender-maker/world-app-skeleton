import{k as d}from"./chunk-SPQ2JWKS.js";function I(e){return(e||"").trim().toLowerCase().replace(/\s+/g," ").replace(/[â€™']/g,"").replace(/[^a-z0-9 ]/g,"")}function P(e){let n=String(e??"").trim().toUpperCase();return/^[A-Z]{2}$/.test(n)?n:null}function x(e){let n=[],t=a=>{if(Array.isArray(a))for(let l of a)Array.isArray(l)&&l.length>=2&&n.push([l[0],l[1]])},o=e?.type,s=e?.coordinates;if(!o||!Array.isArray(s))return null;if(o==="Polygon")for(let a of s)t(a);else if(o==="MultiPolygon"){for(let a of s)if(Array.isArray(a))for(let l of a)t(l)}if(!n.length)return null;let r=0,u=0;for(let[a,l]of n)r+=a,u+=l;return{lng:r/n.length,lat:u/n.length}}function w(e){let n=[],t=i=>{if(Array.isArray(i))for(let c of i)Array.isArray(c)&&c.length>=2&&n.push([c[0],c[1]])},o=e?.type,s=e?.coordinates;if(!o||!Array.isArray(s))return null;if(o==="Polygon")for(let i of s)t(i);else if(o==="MultiPolygon"){for(let i of s)if(Array.isArray(i))for(let c of i)t(c)}if(!n.length)return null;let r=1/0,u=-1/0,a=1/0,l=-1/0;for(let[i,c]of n)i<r&&(r=i),i>u&&(u=i),c<a&&(a=c),c>l&&(l=c);return{minLat:a,maxLat:l,minLng:r,maxLng:u}}function S(e,n){let t=Math.max(.1,e*n),o=.25+Math.log10(t+1)*.25;return Math.max(.22,Math.min(1.1,o))}function j(e,n){let t=Math.max(e,n),o=.7+Math.min(2.2,t/22);return Math.max(.9,Math.min(2.25,o))}function A(e,n,t){let o=!1;for(let s=0,r=t.length-1;s<t.length;r=s++){let u=t[s][0],a=t[s][1],l=t[r][0],i=t[r][1];a>n!=i>n&&e<(l-u)*(n-a)/(i-a||1e-12)+u&&(o=!o)}return o}function L(e,n,t){if(!Array.isArray(t)||!t.length)return!1;let o=t[0];if(!Array.isArray(o)||o.length<3||!A(e,n,o))return!1;for(let s=1;s<t.length;s++){let r=t[s];if(Array.isArray(r)&&r.length>=3&&A(e,n,r))return!1}return!0}function _(e,n,t){let o=e?.type,s=e?.coordinates;if(!o||!Array.isArray(s))return!1;if(o==="Polygon")return L(n,t,s);if(o==="MultiPolygon"){for(let r of s)if(L(n,t,r))return!0;return!1}return!1}function z(e){let n=e>>>0;return()=>{n|=0,n=n+1831565813|0;let t=Math.imul(n^n>>>15,1|n);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}function E(e){let n=2166136261;for(let t=0;t<e.length;t++)n^=e.charCodeAt(t),n=Math.imul(n,16777619);return Math.abs(n)}function N(e,n){let t=e?.geometry,o=w(t),s=x(t)||{lat:0,lng:0};if(!o)return[s];let{minLat:r,maxLat:u,minLng:a,maxLng:l}=o,i=Math.max(.1,u-r),c=Math.max(.1,l-a),f=Math.max(40,Math.min(n,Math.floor(50+i*c*1.5))),g=E((e?.properties?.ISO_A2??e?.properties?.NAME??"")+"|"+e?.__id),y=z(g),m=[],C=f*50,p=0;for(;m.length<f&&p<C;){p++;let h=a+y()*(l-a),b=r+y()*(u-r);_(t,h,b)&&m.push({lat:b,lng:h})}return m.length||m.push(s),m}var M=class e{async loadCountries(){let n=await this.fetchCountriesGeoJson(),o=(Array.isArray(n?.features)?n.features:[]).filter(r=>r?.geometry?.type==="Polygon"||r?.geometry?.type==="MultiPolygon").filter(r=>(r?.properties?.NAME||r?.properties?.ADMIN)&&r?.properties?.ISO_A2!=="AQ");o.forEach((r,u)=>r.__id=u+1);let s=o.map(r=>{let u=r.properties||{},a=u.NAME||u.ADMIN||"Unknown",l=x(r.geometry)||{lat:0,lng:0},i=w(r.geometry),c=i?Math.max(.1,i.maxLat-i.minLat):10,f=i?Math.max(.1,i.maxLng-i.minLng):10,g=P(u.ISO_A2??u.iso_a2??u.ISO2),y=N(r,240);return{id:r.__id,name:a,norm:I(a),center:l,labelSize:S(c,f),flyAltitude:j(c,f),code:g,pointPool:y}}).sort((r,u)=>r.name.localeCompare(u.name));return{features:o,countries:s}}getGeoJsonCandidates(){let n=document.querySelector("base")?.getAttribute("href")??"/",t=new URL(n,window.location.origin).toString();return["countries50m.geojson","public/countries50m.geojson","assets/countries50m.geojson","assets/countries.geojson"].map(s=>new URL(s,t).toString())}async fetchCountriesGeoJson(){let n=this.getGeoJsonCandidates(),t=null;for(let o of n)try{let s=await fetch(o);if(!s.ok)throw new Error(`${o} HTTP ${s.status}`);return await s.json()}catch(s){t=s}throw t||new Error("GeoJSON fetch failed")}static \u0275fac=function(t){return new(t||e)};static \u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"})};export{M as a};
