import{b as e}from"./chunk-KO5X6LCN.js";import{k as d}from"./chunk-SPQ2JWKS.js";var m=class u{async uploadPostMedia(t){let{data:a,error:c}=await e.auth.getSession();if(c)throw c;let o=a.session?.user?.id;if(!o)throw new Error("Not authenticated");let n=(t.name.split(".").pop()||"bin").toLowerCase(),s=`${o}/${crypto.randomUUID()}.${n}`,{error:r}=await e.storage.from("posts").upload(s,t,{upsert:!1,cacheControl:"3600",contentType:t.type||"application/octet-stream"});if(r)throw r;let{data:i}=e.storage.from("posts").getPublicUrl(s);return{path:s,publicUrl:i.publicUrl}}async uploadMessageMedia(t,a){let{data:c,error:o}=await e.auth.getSession();if(o)throw o;let n=c.session?.user?.id;if(!n)throw new Error("Not authenticated");let s=(t.name.split(".").pop()||"bin").toLowerCase(),r=t.name||`message.${s}`,i=`${n}/${a}/${crypto.randomUUID()}.${s}`,{error:p}=await e.storage.from("messages").upload(i,t,{upsert:!1,cacheControl:"3600",contentType:t.type||"application/octet-stream"});if(p)throw p;return{path:i,name:r,mime:t.type||"application/octet-stream",size:t.size}}async uploadAvatar(t){let a=(t.name.split(".").pop()||"").toLowerCase();if(a==="gif"||t.type==="image/gif")throw new Error("GIF avatars are disabled for now. Please upload PNG/JPG/WebP.");let{data:c,error:o}=await e.auth.getSession();if(o)throw o;let n=c.session?.user?.id;if(!n)throw new Error("Not authenticated");let s=(a||"png").toLowerCase(),r=`${n}/${crypto.randomUUID()}.${s}`,{error:i}=await e.storage.from("avatars").upload(r,t,{upsert:!0,cacheControl:"3600",contentType:t.type||"image/png"});if(i)throw i;let{data:p,error:l}=await e.storage.from("avatars").createSignedUrl(r,3600*24*30);if(!l&&p?.signedUrl)return{path:r,url:p.signedUrl};let{data:g}=e.storage.from("avatars").getPublicUrl(r);return{path:r,url:g.publicUrl}}static \u0275fac=function(a){return new(a||u)};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};export{m as a};
