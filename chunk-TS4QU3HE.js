import{$ as M,C as P,D as c,Da as O,H as C,L as _,O as w,P as p,Q as d,R as u,S as m,Y as y,Z as h,_ as v,aa as V,ba as T,ca as g,ea as E,p as s,q as l,r as f,u as b,ya as x}from"./chunk-SPQ2JWKS.js";var I=["videoEl"];function F(o,e){o&1&&(f(),d(0,"svg",9),m(1,"path",10)(2,"path",11)(3,"path",12),u())}function B(o,e){o&1&&(f(),d(0,"svg",9),m(1,"path",10)(2,"line",13)(3,"line",14),u())}function L(o,e){if(o&1){let t=y();d(0,"button",7),h("click",function(i){s(t);let r=v(),a=g(2);return l(r.toggleMute(a,i))}),_(1,F,4,0,"svg",8)(2,B,4,0,"svg",8),u()}if(o&2){let t=v();w("aria-label",t.isMuted?"Unmute video":"Mute video"),c(),p("ngIf",!t.isMuted),c(),p("ngIf",t.isMuted)}}function S(o,e){o&1&&(f(),d(0,"svg",17),m(1,"path",18),u())}function q(o,e){o&1&&(f(),d(0,"svg",17),m(1,"rect",19)(2,"rect",20),u())}function R(o,e){if(o&1){let t=y();d(0,"button",15),h("click",function(i){s(t);let r=v(),a=g(2);return l(r.onVideoTap(a,i))}),_(1,S,2,0,"svg",16)(2,q,3,0,"svg",16),u()}if(o&2){let t=v();c(),p("ngIf",!t.isPlaying),c(),p("ngIf",t.isPlaying)}}function A(o,e){o&1&&(d(0,"div",21),m(1,"span",22),u())}var k=class o{static globalMuted=!1;src;poster=null;preload="metadata";showMute=!0;centerOverlayMode="on-click";tapBehavior="toggle";videoTap=new b;viewed=new b;videoRef;isPlaying=!1;isMuted=!1;isBuffering=!1;controlsVisible=!0;currentTime=0;duration=0;progressPercent=0;centerOverlayVisible=!1;hideTimer=null;centerTimer=null;observer=null;autoPaused=!1;userPaused=!1;isInView=!1;muteHandler=null;viewTracked=!1;handleHostClick(e){if(this.tapBehavior!=="emit")return;let t=e.target;t&&(t.closest(".controls")||t.closest("button")||t.closest("input")||(e.stopPropagation(),this.videoTap.emit()))}get showCenterOverlay(){return this.centerOverlayMode==="on-click"?this.centerOverlayVisible:!this.isPlaying}onVideoTap(e,t){if(this.tapBehavior==="emit"){t.stopPropagation(),this.videoTap.emit();return}if(this.tapBehavior==="none"){t.stopPropagation();return}this.togglePlay(e,t)}togglePlay(e,t){t.stopPropagation(),this.triggerCenterOverlay(),e.paused?(this.userPaused=!1,this.autoPaused=!1,e.play()):(this.userPaused=!0,this.autoPaused=!1,e.pause()),this.revealControls()}toggleMute(e,t){t.stopPropagation(),o.globalMuted=!e.muted,this.applyGlobalMute(e,o.globalMuted),window.dispatchEvent(new CustomEvent("video-player-mute",{detail:o.globalMuted})),this.revealControls()}toggleFullscreen(e,t){t.stopPropagation();let n=e.closest(".video-shell");if(!n)return;let i=document,r=e;if(!i.fullscreenEnabled&&r.webkitEnterFullscreen){r.webkitEnterFullscreen(),this.revealControls();return}if(i.fullscreenElement||i.webkitFullscreenElement||i.msFullscreenElement){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen?i.webkitExitFullscreen():i.msExitFullscreen&&i.msExitFullscreen(),this.revealControls();return}n.requestFullscreen?n.requestFullscreen():r.webkitEnterFullscreen?r.webkitEnterFullscreen():e.requestFullscreen?e.requestFullscreen():n.classList.toggle("is-fullscreen"),this.revealControls()}onLoaded(e){this.duration=Number.isFinite(e.duration)?e.duration:0,this.requestAutoplay(e)}onTimeUpdate(e){this.currentTime=e.currentTime||0,this.duration=Number.isFinite(e.duration)?e.duration:this.duration,this.progressPercent=this.duration?this.currentTime/this.duration*100:0,this.trackView(e)}onScrub(e,t){e.stopPropagation();let n=e.target,i=Number(n.value);this.duration&&(t.currentTime=i/100*this.duration,this.currentTime=t.currentTime,this.progressPercent=i,this.revealControls())}onPlay(){this.isPlaying=!0,this.userPaused=!1,this.autoPaused=!1,this.revealControls()}onPause(){this.isPlaying=!1,this.controlsVisible=!0,this.clearHideTimer()}onError(){this.isPlaying=!1,this.isBuffering=!1,this.controlsVisible=!0,this.clearHideTimer()}onEnded(){this.isPlaying=!1,this.controlsVisible=!0,this.currentTime=0,this.progressPercent=0}setBuffering(e){this.isBuffering=e,e||this.requestAutoplay(this.videoRef.nativeElement)}revealControls(){this.controlsVisible=!0,this.clearHideTimer(),this.isPlaying&&(this.hideTimer=setTimeout(()=>{this.controlsVisible=!1},2200))}formatTime(e){if(!Number.isFinite(e))return"0:00";let t=Math.floor(e),n=Math.floor(t/60),i=t%60;return`${n}:${i.toString().padStart(2,"0")}`}clearHideTimer(){this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null)}triggerCenterOverlay(){this.centerOverlayMode==="on-click"&&(this.centerOverlayVisible=!0,this.centerTimer&&clearTimeout(this.centerTimer),this.centerTimer=setTimeout(()=>{this.centerOverlayVisible=!1},1100))}ngAfterViewInit(){let e=this.videoRef.nativeElement,n=(typeof window<"u"?window.__videoMuted:void 0)===!0?!0:o.globalMuted;o.globalMuted=n,this.applyGlobalMute(e,n),this.muteHandler=i=>{let r=i.detail;o.globalMuted=r,this.applyGlobalMute(e,r)},window.addEventListener("video-player-mute",this.muteHandler),this.observer=new IntersectionObserver(i=>{for(let r of i)r.isIntersecting?(this.isInView=!0,this.requestAutoplay(e),this.autoPaused=!1):(this.isInView=!1,!e.paused&&!e.ended&&(this.autoPaused=!0,e.pause()))},{threshold:.35}),this.observer.observe(e)}ngOnDestroy(){this.observer?.disconnect(),this.observer=null,this.centerTimer&&(clearTimeout(this.centerTimer),this.centerTimer=null),this.muteHandler&&(window.removeEventListener("video-player-mute",this.muteHandler),this.muteHandler=null)}applyGlobalMute(e,t){e.muted=t,this.isMuted=t;try{window.__videoMuted=t}catch{}}trackView(e){this.viewTracked||this.isInView&&(e.currentTime<.5||(this.viewTracked=!0,this.viewed.emit()))}requestAutoplay(e){if(!this.isInView||this.userPaused||!e.paused&&!e.ended)return;let t=e.play();t&&typeof t.catch=="function"&&t.catch(()=>{})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-video-player"]],viewQuery:function(t,n){if(t&1&&M(I,7),t&2){let i;V(i=T())&&(n.videoRef=i.first)}},hostBindings:function(t,n){t&1&&h("click",function(r){return n.handleHostClick(r)})},inputs:{src:"src",poster:"poster",preload:"preload",showMute:"showMute",centerOverlayMode:"centerOverlayMode",tapBehavior:"tapBehavior"},outputs:{videoTap:"videoTap",viewed:"viewed"},decls:7,vars:8,consts:[["videoEl",""],[1,"video-shell",3,"mousemove","touchstart"],["playsinline","",3,"click","timeupdate","loadedmetadata","canplay","error","ended","play","pause","waiting","playing","src"],[1,"video-overlay"],["class","mute-toggle","type","button",3,"click",4,"ngIf"],["class","center-play","type","button","aria-label","Play video",3,"click",4,"ngIf"],["class","buffering",4,"ngIf"],["type","button",1,"mute-toggle",3,"click"],["class","icon-svg icon-stroke","viewBox","0 0 24 24","aria-hidden","true",4,"ngIf"],["viewBox","0 0 24 24","aria-hidden","true",1,"icon-svg","icon-stroke"],["d","M4 10h4l5-4v12l-5-4H4z"],["d","M16 9a3 3 0 0 1 0 6"],["d","M18.5 6.5a6 6 0 0 1 0 11"],["x1","16","y1","8","x2","21","y2","13"],["x1","21","y1","8","x2","16","y2","13"],["type","button","aria-label","Play video",1,"center-play",3,"click"],["class","center-icon","viewBox","0 0 24 24","aria-hidden","true",4,"ngIf"],["viewBox","0 0 24 24","aria-hidden","true",1,"center-icon"],["d","M8 5v14l11-7z"],["x","6","y","5","width","4","height","14","rx","1"],["x","14","y","5","width","4","height","14","rx","1"],[1,"buffering"],[1,"spinner"]],template:function(t,n){if(t&1){let i=y();d(0,"div",1),h("mousemove",function(){return s(i),l(n.revealControls())})("touchstart",function(){return s(i),l(n.revealControls())}),d(1,"video",2,0),h("click",function(a){s(i);let H=g(2);return l(n.onVideoTap(H,a))})("timeupdate",function(){s(i);let a=g(2);return l(n.onTimeUpdate(a))})("loadedmetadata",function(){s(i);let a=g(2);return l(n.onLoaded(a))})("canplay",function(){return s(i),l(n.setBuffering(!1))})("error",function(){return s(i),l(n.onError())})("ended",function(){return s(i),l(n.onEnded())})("play",function(){return s(i),l(n.onPlay())})("pause",function(){return s(i),l(n.onPause())})("waiting",function(){return s(i),l(n.setBuffering(!0))})("playing",function(){return s(i),l(n.setBuffering(!1))}),u(),m(3,"div",3),_(4,L,3,3,"button",4)(5,R,3,2,"button",5)(6,A,2,0,"div",6),u()}t&2&&(E("is-playing",n.isPlaying),c(),p("src",n.src,P),w("poster",n.poster||null)("preload",n.preload),c(3),p("ngIf",n.showMute),c(),p("ngIf",n.showCenterOverlay),c(),p("ngIf",n.isBuffering))},dependencies:[O,x],styles:["[_nghost-%COMP%]{display:block;width:100%}.reel-player[_nghost-%COMP%]{height:100%}.reel-player[_nghost-%COMP%]   .video-shell[_ngcontent-%COMP%]{height:100%}.reel-player[_nghost-%COMP%]   video[_ngcontent-%COMP%]{height:100%;max-height:none;object-fit:cover}.reel-player[_nghost-%COMP%]   .center-play[_ngcontent-%COMP%]{width:96px;height:96px;background:#d2d2dc59;border:1px solid rgba(255,255,255,.4);box-shadow:0 18px 40px #0006;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.reel-player[_nghost-%COMP%]   .center-icon[_ngcontent-%COMP%]{width:34px;height:34px}.reel-player[_nghost-%COMP%]   .mute-toggle[_ngcontent-%COMP%]{top:16px;right:16px;width:52px;height:52px;border-radius:50%;border:1px solid rgba(255,255,255,.2);background:#080a0ea6;color:#fff;box-shadow:none}.reel-player[_nghost-%COMP%]   .icon-svg[_ngcontent-%COMP%]{width:22px;height:22px}.controls-hidden[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{display:none}.video-shell[_ngcontent-%COMP%]{position:relative;width:100%;background:#050505;overflow:hidden}.video-shell[_ngcontent-%COMP%]:fullscreen, .video-shell[_ngcontent-%COMP%]:-webkit-full-screen, .video-shell.is-fullscreen[_ngcontent-%COMP%]{width:100vw;height:100vh;max-height:100vh;border-radius:0;background:#000}.video-shell.is-fullscreen[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999}video[_ngcontent-%COMP%]{width:100%;display:block;max-height:none;height:auto;object-fit:contain;background:#000}.video-shell[_ngcontent-%COMP%]:fullscreen   video[_ngcontent-%COMP%], .video-shell[_ngcontent-%COMP%]:-webkit-full-screen   video[_ngcontent-%COMP%], .video-shell.is-fullscreen[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-height:100vh;height:100%;object-fit:contain}.video-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(180deg,#0000008c,#0000 45%,#000000a6);opacity:.7;transition:opacity .2s ease;pointer-events:none}.video-shell.is-playing[_ngcontent-%COMP%]   .video-overlay[_ngcontent-%COMP%]{opacity:.3}.center-play[_ngcontent-%COMP%]{position:absolute;inset:0;margin:auto;width:84px;height:84px;border-radius:50%;border:0;background:#0a0a0ac7;display:grid;place-items:center;box-shadow:0 10px 30px #00000059;cursor:pointer;transition:transform .18s ease,background .18s ease}.center-play[_ngcontent-%COMP%]:hover{transform:scale(1.05);background:#0a0a0ae6}.play-icon[_ngcontent-%COMP%]{width:0;height:0;border-top:16px solid transparent;border-bottom:16px solid transparent;border-left:26px solid #fff;margin-left:6px}.center-icon[_ngcontent-%COMP%]{width:26px;height:26px;fill:#fff}.mute-toggle[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;width:34px;height:34px;border-radius:50%;border:1px solid rgba(255,255,255,.2);background:#0000008c;color:#fff;display:grid;place-items:center;cursor:pointer;z-index:3}.buffering[_ngcontent-%COMP%]{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}.spinner[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:50%;border:3px solid rgba(255,255,255,.25);border-top-color:#fff;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.icon-svg[_ngcontent-%COMP%]{width:18px;height:18px;display:block}.icon-stroke[_ngcontent-%COMP%]{fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}"]})};export{k as a};
