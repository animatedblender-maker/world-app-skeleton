import{a as n}from"./chunk-LQQHCQP3.js";import{c as p}from"./chunk-KO5X6LCN.js";import{k as c,n as u}from"./chunk-SPQ2JWKS.js";var h=class o{constructor(i){this.auth=i}swUrl="/sw.js";registrationPromise=null;isSupported(){return typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&!!n.pushPublicKey}async syncIfGranted(){this.isSupported()&&"Notification"in window&&Notification.permission==="granted"&&await this.ensureSubscription()}async enableFromUserGesture(){!this.isSupported()||!("Notification"in window)||(Notification.permission==="default"?await Notification.requestPermission():Notification.permission)!=="granted"||await this.ensureSubscription()}async ensureSubscription(){let i=await this.getRegistration(),t=await i.pushManager.getSubscription()??await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(n.pushPublicKey)});await this.sendSubscription(t)}async getRegistration(){return this.registrationPromise||(this.registrationPromise=navigator.serviceWorker.register(this.swUrl)),this.registrationPromise}async sendSubscription(i){let r=await this.auth.getAccessToken();if(!r)return;let t=i.toJSON();if(!t?.endpoint||!t?.keys?.p256dh||!t?.keys?.auth)return;let e=n.apiBaseUrl||n.graphqlEndpoint.replace(/\/graphql$/,"");await fetch(`${e}/push/subscribe`,{method:"POST",headers:{"content-type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({subscription:t,userAgent:navigator.userAgent})})}urlBase64ToUint8Array(i){let r="=".repeat((4-i.length%4)%4),t=(i+r).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(t),a=new Uint8Array(e.length);for(let s=0;s<e.length;++s)a[s]=e.charCodeAt(s);return a.buffer}static \u0275fac=function(r){return new(r||o)(u(p))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
